var PLATFORM = process.platform;     // win32|linux
var RUNNING_ON_WINDOWS = (PLATFORM.match(/win32/i) != null);
var SCRIPT_PATH = RUNNING_ON_WINDOWS ? "./" : __dirname + "/"

var logger = require("winston");
var utils = require(SCRIPT_PATH + "kummer-utils.js");

logger.level = "verbose";
logger.add(logger.transports.File, {
  json: false,
  formatter: utils.logFormatter,
  filename: SCRIPT_PATH + "test-env.log" });

// Display useful info
logger.verbose("Platform is " + process.platform);
logger.verbose("SCRIPT_PATH is " + SCRIPT_PATH);

// Use native JS code to read from environment variables
logger.verbose("Slack vaca is " + process.env.KU_SLACK_STATUS_VACATION);

// Use Node package node-env-configuration to make this easy!!!!
// https://github.com/whynotsoluciones/node-env-configuration
var nodeenvconfiguration = require('node-env-configuration');
var config = nodeenvconfiguration({
  //defaults: defaultConfiguration,
  prefix: 'ku' // Read only env vars starting with KI prefix 
});

logger.verbose("config.slack.token is " + config.slack.token);

var family = config.family;
for (var key in family) {
  if (family.hasOwnProperty(key)) {
    // familY[key] is object for a family member
    logger.verbose(key);

    // loop through all children objects
    for (var key2 in family[key]) {
      if (family[key].hasOwnProperty(key2)) {
        logger.verbose("    " + key2 + " => " + family[key][key2]);
      }
    }
  }
}

// Here's how to look up family member by name
logger.verbose("Brian's phone is " + config.family["Brian".toLowerCase()].phonenumber);

// TODO- How iterate through all family members?
for (var key in config.family) {
  if (config.family.hasOwnProperty(key)) {
    logger.verbose(key);
        logger.verbose("    " + key2 + " => " + family[key][key2]);
      }
    }
  }
}



function getFamilyMemberByName(name) {

  var nameLower = name.toLowerCase();
  var family = config.family;

  var brian = family[name]
  /*
  var family = config.family;
  for (var key in family) {
    if (family.hasOwnProperty(key) && key.matches() {
    // familY[key] is object for a family member
    logger.verbose(key);

    // loop through all children objects
    for (var key2 in family[key]) {
      if (family[key].hasOwnProperty(key2)) {
        logger.verbose("    " + key2 + " => " + family[key][key2]);
      }
    }
  }
  */
}
